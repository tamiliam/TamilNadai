{% if sentences %}
<div class="space-y-3">
    {% for s in sentences %}
    <div class="bg-leaf-50 rounded-lg border transition-colors
                {% if s.status == 'accepted' %}border-l-4 border-l-palmgreen border-grain-light{% elif s.status == 'rejected' %}border-l-4 border-l-terracotta border-grain-light{% else %}border-grain-light hover:border-grain{% endif %}">

        <div class="p-4">
            <!-- Sentence text -->
            <p class="tamil-serif text-etch leading-relaxed text-base
                      {% if s.status == 'accepted' %}font-semibold{% endif %}">
                {{ s.sentence }}
            </p>

            <!-- Metadata row -->
            <div class="flex flex-wrap items-center gap-2 mt-3">
                <span class="font-mono text-xs font-medium text-stylus">{{ s.sentence_id }}</span>

                <span class="px-2 py-0.5 rounded text-xs
                    {% if s.source == 'book' %}bg-leaf-300 text-etch-light
                    {% elif s.source == 'ai' %}bg-stylus/10 text-stylus-dark
                    {% elif s.source == 'proposed' %}bg-terracotta-bg text-terracotta
                    {% else %}bg-leaf-200 text-etch-lighter{% endif %}">
                    {% if s.created_by and s.source != 'book' and s.source != 'ai' %}
                        {{ s.created_by.get_full_name|default:s.created_by.username }}
                    {% else %}
                        {{ s.get_source_display }}
                    {% endif %}
                </span>

                <span class="px-2 py-0.5 rounded text-xs
                    {% if s.status == 'pending' %}bg-stylus/10 text-stylus-dark
                    {% elif s.status == 'review_1_done' %}bg-leaf-400/20 text-etch-light
                    {% elif s.status == 'accepted' %}bg-palmgreen-bg text-palmgreen
                    {% elif s.status == 'rejected' %}bg-terracotta-bg text-terracotta{% endif %}">
                    {{ s.get_status_display }}
                </span>

                {% for r in s.review_list %}
                <span class="text-xs text-etch-lighter">
                    <span class="material-symbols-outlined text-xs align-middle" style="font-size:14px">
                        {% if r.action == 'accept' %}check_circle{% else %}cancel{% endif %}
                    </span>
                    R{{ r.review_number }}
                    <span class="{% if r.action == 'accept' %}text-palmgreen{% else %}text-terracotta{% endif %}">{{ r.get_action_display }}</span>
                    by {{ r.reviewer.get_full_name|default:r.reviewer.username }}
                    {% if r.comment %}&mdash; <em>{{ r.comment|truncatechars:40 }}</em>{% endif %}
                </span>
                {% endfor %}
            </div>

            <!-- Action bar -->
            {% if is_reviewer_or_above and not s.user_already_reviewed and s.review_count < 2 %}
            <div class="mt-3 pt-3 border-t border-grain-light/50">
                <form method="post" action="{% url 'review_sentence' s.sentence_id %}" class="space-y-2">
                    {% csrf_token %}
                    <textarea name="comment" rows="1" placeholder="Comment (optional)..."
                        class="w-full border border-grain rounded-md px-3 py-2 text-sm bg-leaf-50 text-etch tamil focus:ring-1 focus:ring-stylus placeholder-grain resize-y"></textarea>
                    <div class="flex items-center justify-between">
                        <div class="flex gap-2">
                            <button type="submit" name="action" value="accept"
                                class="inline-flex items-center gap-1 bg-palmgreen-bg text-palmgreen border border-palmgreen/30 px-3 py-1.5 rounded-md text-xs hover:bg-palmgreen hover:text-leaf-50 transition-colors">
                                <span class="material-symbols-outlined" style="font-size:14px">check</span>
                                Accept
                            </button>
                            <button type="submit" name="action" value="reject"
                                class="inline-flex items-center gap-1 bg-terracotta-bg text-terracotta border border-terracotta/30 px-3 py-1.5 rounded-md text-xs hover:bg-terracotta hover:text-leaf-50 transition-colors">
                                <span class="material-symbols-outlined" style="font-size:14px">close</span>
                                Reject
                            </button>
                        </div>
                        {% if is_admin %}
                        <div class="flex items-center gap-3">
                            <button type="button" onclick="document.getElementById('edit-{{ s.sentence_id }}').classList.toggle('hidden')"
                                class="inline-flex items-center gap-1 text-xs text-stylus hover:text-stylus-dark">
                                <span class="material-symbols-outlined" style="font-size:14px">edit</span>
                                Edit
                            </button>
                            <button type="button" onclick="if(confirm('Delete {{ s.sentence_id }}?')) document.getElementById('del-{{ s.sentence_id }}').submit()"
                                class="inline-flex items-center gap-1 text-xs text-terracotta hover:text-terracotta-light">
                                <span class="material-symbols-outlined" style="font-size:14px">delete</span>
                                Delete
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </form>
            </div>
            {% elif is_admin %}
            <div class="mt-3 pt-3 border-t border-grain-light/50 flex items-center justify-between">
                {% if s.user_already_reviewed %}
                <span class="text-xs text-etch-lighter italic">You've reviewed this</span>
                {% else %}
                <div></div>
                {% endif %}
                <div class="flex items-center gap-3">
                    <button onclick="document.getElementById('edit-{{ s.sentence_id }}').classList.toggle('hidden')"
                        class="inline-flex items-center gap-1 text-xs text-stylus hover:text-stylus-dark">
                        <span class="material-symbols-outlined" style="font-size:14px">edit</span>
                        Edit
                    </button>
                    <form method="post" action="{% url 'delete_sentence' s.sentence_id %}" onsubmit="return confirm('Delete {{ s.sentence_id }}?')">
                        {% csrf_token %}
                        <button type="submit" class="inline-flex items-center gap-1 text-xs text-terracotta hover:text-terracotta-light">
                            <span class="material-symbols-outlined" style="font-size:14px">delete</span>
                            Delete
                        </button>
                    </form>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Hidden delete form (for delete button inside review form) -->
        {% if is_admin %}
        <form id="del-{{ s.sentence_id }}" method="post" action="{% url 'delete_sentence' s.sentence_id %}" class="hidden">
            {% csrf_token %}
        </form>
        {% endif %}

        <!-- Admin edit form (hidden) -->
        {% if is_admin %}
        <div id="edit-{{ s.sentence_id }}" class="hidden px-4 pb-4">
            <form method="post" action="{% url 'edit_sentence' s.sentence_id %}" class="flex gap-2 items-center p-3 bg-leaf-200 rounded-lg">
                {% csrf_token %}
                <span class="font-mono text-xs text-stylus whitespace-nowrap">{{ s.sentence_id }}</span>
                <input type="text" name="sentence" value="{{ s.sentence }}"
                    class="flex-1 border border-grain rounded-lg px-3 py-2 text-sm tamil bg-leaf-50 text-etch focus:ring-1 focus:ring-stylus">
                <button type="submit" class="bg-stylus text-leaf-50 px-4 py-2 rounded-lg text-xs font-medium hover:bg-stylus-dark transition-colors">Save</button>
                <button type="button" onclick="document.getElementById('edit-{{ s.sentence_id }}').classList.add('hidden')" class="text-xs text-etch-lighter hover:underline">Cancel</button>
            </form>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div class="bg-leaf-50 border border-grain-light rounded-lg p-8 text-center">
    <span class="material-symbols-outlined text-grain text-3xl mb-2">draft</span>
    <p class="text-sm text-etch-lighter mt-2">No {{ type }} sentences yet.</p>
</div>
{% endif %}
