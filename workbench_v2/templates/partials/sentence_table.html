<!-- Sentence table partial -->
{% if sentences %}
<div class="overflow-x-auto">
    <table class="w-full text-sm">
        <thead class="bg-leaf-200">
            <tr>
                <th class="px-4 py-2 text-left text-xs font-medium text-etch-lighter w-28">ID</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-etch-lighter">Sentence</th>
                <th class="px-4 py-2 text-center text-xs font-medium text-etch-lighter w-20">Source</th>
                <th class="px-4 py-2 text-center text-xs font-medium text-etch-lighter w-28">Status</th>
                <th class="px-4 py-2 text-left text-xs font-medium text-etch-lighter w-64">Reviews</th>
                <th class="px-4 py-2 text-right text-xs font-medium text-etch-lighter w-40">Actions</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-grain-light">
            {% for s in sentences %}
            <tr class="hover:bg-leaf-200 transition-colors {% if s.status == 'accepted' %}bg-palmgreen-bg/30{% endif %}">
                <td class="px-4 py-3">
                    <span class="font-mono text-xs font-semibold text-stylus">{{ s.sentence_id }}</span>
                </td>
                <td class="px-4 py-3">
                    <span class="{% if s.status == 'accepted' %}etched{% endif %} tamil-serif text-etch">{{ s.sentence }}</span>
                </td>
                <td class="px-4 py-3 text-center">
                    <span class="px-2 py-0.5 rounded text-xs
                        {% if s.source == 'book' %}bg-leaf-300 text-etch-light
                        {% elif s.source == 'ai' %}bg-stylus/10 text-stylus-dark
                        {% else %}bg-leaf-200 text-etch-lighter{% endif %}">
                        {{ s.get_source_display }}
                    </span>
                </td>
                <td class="px-4 py-3 text-center">
                    <span class="px-2 py-0.5 rounded text-xs
                        {% if s.status == 'pending' %}bg-stylus/10 text-stylus-dark
                        {% elif s.status == 'review_1_done' %}bg-leaf-400/20 text-etch-light
                        {% elif s.status == 'accepted' %}bg-palmgreen-bg text-palmgreen
                        {% elif s.status == 'rejected' %}bg-terracotta-bg text-terracotta{% endif %}">
                        {{ s.get_status_display }}
                    </span>
                </td>
                <td class="px-4 py-3">
                    {% for r in s.review_list %}
                    <div class="text-xs mb-1">
                        <span class="font-medium text-etch-light">R{{ r.review_number }}:</span>
                        <span class="{% if r.action == 'accept' %}text-palmgreen{% else %}text-terracotta{% endif %}">{{ r.get_action_display }}</span>
                        <span class="text-etch-lighter">by {{ r.reviewer.get_full_name|default:r.reviewer.username }}</span>
                        {% if r.comment %}<span class="text-etch-lighter italic"> &mdash; {{ r.comment|truncatechars:40 }}</span>{% endif %}
                    </div>
                    {% empty %}
                    <span class="text-xs text-etch-lighter">Awaiting review</span>
                    {% endfor %}
                </td>
                <td class="px-4 py-3 text-right">
                    <div class="flex flex-col gap-1 items-end">
                        {% if not s.user_already_reviewed and s.review_count < 2 %}
                        <form method="post" action="{% url 'review_sentence' s.sentence_id %}" class="inline-flex gap-1 items-center">
                            {% csrf_token %}
                            <input type="text" name="comment" placeholder="Comment..."
                                class="border border-grain rounded px-2 py-0.5 text-xs w-28 bg-leaf-50 text-etch focus:ring-1 focus:ring-stylus">
                            <button type="submit" name="action" value="accept"
                                class="bg-palmgreen-bg text-palmgreen border border-palmgreen/30 px-2 py-0.5 rounded text-xs hover:bg-palmgreen hover:text-leaf-50 transition-colors">Accept</button>
                            <button type="submit" name="action" value="reject"
                                class="bg-terracotta-bg text-terracotta border border-terracotta/30 px-2 py-0.5 rounded text-xs hover:bg-terracotta hover:text-leaf-50 transition-colors">Reject</button>
                        </form>
                        {% endif %}
                        {% if is_admin %}
                        <div class="flex gap-2 mt-1">
                            <button onclick="this.closest('tr').nextElementSibling.classList.toggle('hidden')" class="text-xs text-stylus hover:underline">Edit</button>
                            <form method="post" action="{% url 'delete_sentence' s.sentence_id %}" onsubmit="return confirm('Delete {{ s.sentence_id }}?')">
                                {% csrf_token %}
                                <button type="submit" class="text-xs text-terracotta hover:underline">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% if is_admin %}
            <tr class="hidden bg-leaf-200">
                <td colspan="6" class="px-4 py-2">
                    <form method="post" action="{% url 'edit_sentence' s.sentence_id %}" class="flex gap-2 items-center">
                        {% csrf_token %}
                        <span class="font-mono text-xs text-stylus">{{ s.sentence_id }}</span>
                        <input type="text" name="sentence" value="{{ s.sentence }}"
                            class="flex-1 border border-grain rounded px-3 py-1 text-sm tamil bg-leaf-50 text-etch focus:ring-1 focus:ring-stylus">
                        <button type="submit" class="bg-stylus text-leaf-50 px-3 py-1 rounded text-xs hover:bg-stylus-dark">Save</button>
                        <button type="button" onclick="this.closest('tr').classList.add('hidden')" class="text-xs text-etch-lighter hover:underline">Cancel</button>
                    </form>
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="p-6 text-center text-sm text-etch-lighter">
    No {{ type }} sentences yet.
</div>
{% endif %}
